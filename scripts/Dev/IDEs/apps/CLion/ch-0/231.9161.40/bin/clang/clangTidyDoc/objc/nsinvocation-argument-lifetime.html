<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>clang-tidy - objc-nsinvocation-argument-lifetime</title>
	/* CLION CLANG-TIDY DOCUMENTATION CSS PLACEHOLDER */
  </head>
  <body><div class="content"><section id="objc-nsinvocation-argument-lifetime">
<h1>objc-nsinvocation-argument-lifetime</h1>
<p>Finds calls to <code class="docutils literal notranslate"><span class="pre">NSInvocation</span></code> methods under ARC that donâ€™t have proper
argument object lifetimes. When passing Objective-C objects as parameters
to the <code class="docutils literal notranslate"><span class="pre">NSInvocation</span></code> methods <code class="docutils literal notranslate"><span class="pre">getArgument:atIndex:</span></code> and
<code class="docutils literal notranslate"><span class="pre">getReturnValue:</span></code>, the values are copied by value into the argument pointer,
which leads to incorrect releasing behavior if the object pointers are
not declared <code class="docutils literal notranslate"><span class="pre">__unsafe_unretained</span></code>.</p>
<p>For code:</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="kt">id</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span><span class="w"></span>
<span class="p">[</span><span class="n">invocation</span><span class="w"> </span><span class="n">getArgument</span><span class="o">:&amp;</span><span class="n">arg</span><span class="w"> </span><span class="n">atIndex</span><span class="o">:</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>

<span class="k">__strong</span><span class="w"> </span><span class="kt">id</span><span class="w"> </span><span class="n">returnValue</span><span class="p">;</span><span class="w"></span>
<span class="p">[</span><span class="n">invocation</span><span class="w"> </span><span class="n">getReturnValue</span><span class="o">:&amp;</span><span class="n">returnValue</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
<p>The fix will be:</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="n">__unsafe_unretained</span><span class="w"> </span><span class="kt">id</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span><span class="w"></span>
<span class="p">[</span><span class="n">invocation</span><span class="w"> </span><span class="n">getArgument</span><span class="o">:&amp;</span><span class="n">arg</span><span class="w"> </span><span class="n">atIndex</span><span class="o">:</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>

<span class="n">__unsafe_unretained</span><span class="w"> </span><span class="kt">id</span><span class="w"> </span><span class="n">returnValue</span><span class="p">;</span><span class="w"></span>
<span class="p">[</span><span class="n">invocation</span><span class="w"> </span><span class="n">getReturnValue</span><span class="o">:&amp;</span><span class="n">returnValue</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
<p>The check will warn on being passed instance variable references that have
lifetimes other than <code class="docutils literal notranslate"><span class="pre">__unsafe_unretained</span></code>, but does not propose a fix:</p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="c1">// &quot;id _returnValue&quot; is declaration of instance variable of class.</span>
<span class="p">[</span><span class="n">invocation</span><span class="w"> </span><span class="n">getReturnValue</span><span class="o">:&amp;</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">_returnValue</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
</section>
</div></body>
</html>